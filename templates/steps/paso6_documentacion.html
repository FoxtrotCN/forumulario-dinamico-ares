<!-- Paso 6: Documentación -->
<div class="step-content">
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info d-flex align-items-center" role="alert">
                <i class="bi bi-info-circle me-3 fs-4"></i>
                <div>
                    <strong>Documentación Requerida</strong><br>
                    Suba los documentos necesarios para completar la configuración del sistema. 
                    Los archivos se almacenarán de forma segura y estarán disponibles para consulta posterior.
                </div>
            </div>
        </div>
    </div>

    <!-- Contratos -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="text-primary mb-3">
                <i class="bi bi-file-earmark-text me-2"></i>Contratos
            </h5>
        </div>

        <div class="col-12 mb-3">
            <label class="form-label">
                Contratos en Formato .docx
                <i class="bi bi-question-circle tooltip-icon ms-1" 
                   data-bs-toggle="tooltip" 
                   title="Suba los contratos de alquiler en formato Word (.docx)"></i>
            </label>
            <div class="upload-area" id="contratos-upload">
                <div class="upload-content">
                    <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                    <h6>Arrastre archivos aquí o haga clic para seleccionar</h6>
                    <p class="text-muted">Formatos permitidos: .docx | Tamaño máximo: 5MB por archivo</p>
                    <input type="file" class="file-input" id="contratos-input" multiple accept=".docx" style="display: none;">
                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('contratos-input').click()">
                        <i class="bi bi-folder2-open me-2"></i>Seleccionar Archivos
                    </button>
                </div>
            </div>
            <div class="uploaded-files mt-3" id="contratos-files"></div>
        </div>
    </div>

    <!-- Planos Gráficos -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="text-primary mb-3">
                <i class="bi bi-diagram-3 me-2"></i>Planos Gráficos
            </h5>
        </div>

        <div class="col-12 mb-3">
            <label class="form-label">
                Plano Gráfico de las Instalaciones
                <i class="bi bi-question-circle tooltip-icon ms-1" 
                   data-bs-toggle="tooltip" 
                   title="Planos arquitectónicos o esquemas de las instalaciones"></i>
            </label>
            <div class="upload-area" id="planos-upload">
                <div class="upload-content">
                    <i class="bi bi-image display-4 text-muted mb-3"></i>
                    <h6>Arrastre imágenes aquí o haga clic para seleccionar</h6>
                    <p class="text-muted">Formatos permitidos: .jpg, .png, .pdf | Tamaño máximo: 5MB por archivo</p>
                    <input type="file" class="file-input" id="planos-input" multiple accept=".jpg,.jpeg,.png,.pdf" style="display: none;">
                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('planos-input').click()">
                        <i class="bi bi-folder2-open me-2"></i>Seleccionar Archivos
                    </button>
                </div>
            </div>
            <div class="uploaded-files mt-3" id="planos-files"></div>
        </div>
    </div>

    <!-- Logo de la Empresa -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="text-primary mb-3">
                <i class="bi bi-image me-2"></i>Logo de la Empresa
            </h5>
        </div>

        <div class="col-md-6 mb-3">
            <label class="form-label">
                Logo Principal
                <i class="bi bi-question-circle tooltip-icon ms-1" 
                   data-bs-toggle="tooltip" 
                   title="Logo principal de la empresa para usar en documentos y sistema"></i>
            </label>
            <div class="upload-area logo-upload" id="logo-upload">
                <div class="upload-content">
                    <i class="bi bi-image display-4 text-muted mb-3"></i>
                    <h6>Logo de la empresa</h6>
                    <p class="text-muted">Formatos: .jpg, .png | Máximo: 2MB</p>
                    <input type="file" class="file-input" id="logo-input" accept=".jpg,.jpeg,.png" style="display: none;">
                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('logo-input').click()">
                        <i class="bi bi-folder2-open me-2"></i>Seleccionar Logo
                    </button>
                </div>
                <div class="logo-preview" style="display: none;">
                    <img src="" alt="Logo preview" class="img-fluid rounded">
                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-logo">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-3">
            <label class="form-label">
                Logo Alternativo (Opcional)
                <i class="bi bi-question-circle tooltip-icon ms-1" 
                   data-bs-toggle="tooltip" 
                   title="Logo alternativo o versión en blanco y negro"></i>
            </label>
            <div class="upload-area logo-upload" id="logo-alt-upload">
                <div class="upload-content">
                    <i class="bi bi-image display-4 text-muted mb-3"></i>
                    <h6>Logo alternativo</h6>
                    <p class="text-muted">Formatos: .jpg, .png | Máximo: 2MB</p>
                    <input type="file" class="file-input" id="logo-alt-input" accept=".jpg,.jpeg,.png" style="display: none;">
                    <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('logo-alt-input').click()">
                        <i class="bi bi-folder2-open me-2"></i>Seleccionar Logo
                    </button>
                </div>
                <div class="logo-preview" style="display: none;">
                    <img src="" alt="Logo alternativo preview" class="img-fluid rounded">
                    <button type="button" class="btn btn-sm btn-outline-danger mt-2 remove-logo">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Documentación Adicional -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="text-primary mb-3">
                <i class="bi bi-file-earmark-plus me-2"></i>Documentación Adicional
            </h5>
        </div>

        <div class="col-12 mb-3">
            <label class="form-label">
                Otros Documentos (Opcional)
                <i class="bi bi-question-circle tooltip-icon ms-1" 
                   data-bs-toggle="tooltip" 
                   title="Cualquier otro documento relevante para la configuración"></i>
            </label>
            <div class="upload-area" id="adicional-upload">
                <div class="upload-content">
                    <i class="bi bi-file-earmark display-4 text-muted mb-3"></i>
                    <h6>Documentos adicionales</h6>
                    <p class="text-muted">Formatos permitidos: .pdf, .docx, .jpg, .png | Tamaño máximo: 5MB por archivo</p>
                    <input type="file" class="file-input" id="adicional-input" multiple accept=".pdf,.docx,.jpg,.jpeg,.png" style="display: none;">
                    <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('adicional-input').click()">
                        <i class="bi bi-folder2-open me-2"></i>Seleccionar Archivos
                    </button>
                </div>
            </div>
            <div class="uploaded-files mt-3" id="adicional-files"></div>
        </div>
    </div>

    <!-- Notas y Comentarios -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="text-primary mb-3">
                <i class="bi bi-chat-text me-2"></i>Notas y Comentarios
            </h5>
        </div>

        <div class="col-12 mb-3">
            <label for="notas_adicionales" class="form-label">
                Notas Adicionales
                <i class="bi bi-question-circle tooltip-icon ms-1" 
                   data-bs-toggle="tooltip" 
                   title="Cualquier información adicional o instrucciones especiales"></i>
            </label>
            <textarea class="form-control" 
                      id="notas_adicionales" 
                      name="notas_adicionales" 
                      rows="4" 
                      placeholder="Escriba aquí cualquier información adicional, instrucciones especiales, o comentarios que considere relevantes para la configuración del sistema..."></textarea>
            <div class="form-text">
                <span class="char-count-notas">0</span>/1000 caracteres
            </div>
        </div>
    </div>

    <!-- Resumen de Documentación -->
    <div class="row">
        <div class="col-12">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                        <i class="bi bi-check2-square me-2"></i>Resumen de Documentación
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="bi bi-file-earmark-text display-4 text-primary"></i>
                            </div>
                            <h6>Contratos</h6>
                            <span class="badge bg-primary" id="count-contratos">0 archivos</span>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="bi bi-diagram-3 display-4 text-info"></i>
                            </div>
                            <h6>Planos</h6>
                            <span class="badge bg-info" id="count-planos">0 archivos</span>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="bi bi-image display-4 text-warning"></i>
                            </div>
                            <h6>Logos</h6>
                            <span class="badge bg-warning" id="count-logos">0 archivos</span>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="mb-2">
                                <i class="bi bi-file-earmark-plus display-4 text-secondary"></i>
                            </div>
                            <h6>Adicionales</h6>
                            <span class="badge bg-secondary" id="count-adicionales">0 archivos</span>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Total de archivos:</strong> <span id="total-archivos">0</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Tamaño total:</strong> <span id="total-tamaño">0 MB</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensaje de finalización -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="alert alert-success">
                <i class="bi bi-check-circle me-2"></i>
                <strong>¡Último paso!</strong> Una vez que haya subido toda la documentación necesaria, 
                podrá completar el formulario y el sistema estará listo para su uso.
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let uploadedFiles = {
        contratos: [],
        planos: [],
        logos: [],
        adicionales: []
    };
    
    // Configurar áreas de upload
    setupUploadArea('contratos', ['docx']);
    setupUploadArea('planos', ['jpg', 'jpeg', 'png', 'pdf']);
    setupUploadArea('adicional', ['pdf', 'docx', 'jpg', 'jpeg', 'png']);
    setupLogoUpload('logo');
    setupLogoUpload('logo-alt');
    
    // Contador de caracteres para notas
    const notasField = document.getElementById('notas_adicionales');
    const charCountNotas = document.querySelector('.char-count-notas');
    
    notasField.addEventListener('input', function() {
        const count = this.value.length;
        charCountNotas.textContent = count;
        
        if (count > 1000) {
            charCountNotas.style.color = '#dc3545';
            this.value = this.value.substring(0, 1000);
            charCountNotas.textContent = '1000';
        } else {
            charCountNotas.style.color = '#6c757d';
        }
    });
    
    function setupUploadArea(type, allowedExtensions) {
        const uploadArea = document.getElementById(`${type}-upload`);
        const fileInput = document.getElementById(`${type}-input`);
        const filesContainer = document.getElementById(`${type}-files`);
        
        // Drag and drop
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files, type, allowedExtensions);
        });
        
        // File input change
        fileInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            handleFiles(files, type, allowedExtensions);
        });
    }
    
    function setupLogoUpload(type) {
        const uploadArea = document.getElementById(`${type}-upload`);
        const fileInput = document.getElementById(`${type}-input`);
        const uploadContent = uploadArea.querySelector('.upload-content');
        const logoPreview = uploadArea.querySelector('.logo-preview');
        const removeBtn = uploadArea.querySelector('.remove-logo');
        
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                if (validateFile(file, ['jpg', 'jpeg', 'png'], 2)) {
                    displayLogoPreview(file, uploadContent, logoPreview);
                    uploadedFiles.logos.push(file);
                    updateResumen();
                }
            }
        });
        
        removeBtn.addEventListener('click', function() {
            logoPreview.style.display = 'none';
            uploadContent.style.display = 'block';
            fileInput.value = '';
            
            // Remover del array
            const fileName = logoPreview.querySelector('img').alt;
            uploadedFiles.logos = uploadedFiles.logos.filter(f => f.name !== fileName);
            updateResumen();
        });
    }
    
    function handleFiles(files, type, allowedExtensions) {
        const validFiles = [];
        
        files.forEach(file => {
            if (validateFile(file, allowedExtensions)) {
                validFiles.push(file);
            }
        });
        
        if (validFiles.length > 0) {
            uploadedFiles[type] = uploadedFiles[type] || [];
            uploadedFiles[type].push(...validFiles);
            
            displayFiles(validFiles, type);
            updateResumen();
        }
    }
    
    function validateFile(file, allowedExtensions, maxSizeMB = 5) {
        const extension = file.name.split('.').pop().toLowerCase();
        const sizeMB = file.size / (1024 * 1024);
        
        if (!allowedExtensions.includes(extension)) {
            showToast(`Formato de archivo no permitido: ${extension}`, 'error');
            return false;
        }
        
        if (sizeMB > maxSizeMB) {
            showToast(`El archivo es demasiado grande: ${sizeMB.toFixed(1)}MB (máximo: ${maxSizeMB}MB)`, 'error');
            return false;
        }
        
        return true;
    }
    
    function displayFiles(files, type) {
        const container = document.getElementById(`${type}-files`);
        
        files.forEach(file => {
            const fileElement = createFileElement(file, type);
            container.appendChild(fileElement);
        });
    }
    
    function createFileElement(file, type) {
        const div = document.createElement('div');
        div.className = 'uploaded-file d-flex align-items-center justify-content-between p-3 border rounded mb-2';
        
        const fileInfo = document.createElement('div');
        fileInfo.className = 'd-flex align-items-center';
        
        const icon = getFileIcon(file.name);
        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
        
        fileInfo.innerHTML = `
            <i class="bi ${icon} me-3 fs-4 text-primary"></i>
            <div>
                <div class="fw-bold">${file.name}</div>
                <small class="text-muted">${sizeMB} MB</small>
            </div>
        `;
        
        const removeBtn = document.createElement('button');
        removeBtn.className = 'btn btn-sm btn-outline-danger';
        removeBtn.innerHTML = '<i class="bi bi-trash"></i>';
        removeBtn.addEventListener('click', function() {
            div.remove();
            removeFileFromArray(file.name, type);
            updateResumen();
        });
        
        div.appendChild(fileInfo);
        div.appendChild(removeBtn);
        
        return div;
    }
    
    function displayLogoPreview(file, uploadContent, logoPreview) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = logoPreview.querySelector('img');
            img.src = e.target.result;
            img.alt = file.name;
            
            uploadContent.style.display = 'none';
            logoPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
    
    function getFileIcon(fileName) {
        const extension = fileName.split('.').pop().toLowerCase();
        const icons = {
            'pdf': 'bi-file-earmark-pdf',
            'docx': 'bi-file-earmark-word',
            'jpg': 'bi-file-earmark-image',
            'jpeg': 'bi-file-earmark-image',
            'png': 'bi-file-earmark-image'
        };
        
        return icons[extension] || 'bi-file-earmark';
    }
    
    function removeFileFromArray(fileName, type) {
        if (uploadedFiles[type]) {
            uploadedFiles[type] = uploadedFiles[type].filter(f => f.name !== fileName);
        }
    }
    
    function updateResumen() {
        const counts = {
            contratos: uploadedFiles.contratos?.length || 0,
            planos: uploadedFiles.planos?.length || 0,
            logos: uploadedFiles.logos?.length || 0,
            adicionales: uploadedFiles.adicionales?.length || 0
        };
        
        document.getElementById('count-contratos').textContent = `${counts.contratos} archivos`;
        document.getElementById('count-planos').textContent = `${counts.planos} archivos`;
        document.getElementById('count-logos').textContent = `${counts.logos} archivos`;
        document.getElementById('count-adicionales').textContent = `${counts.adicionales} archivos`;
        
        const totalFiles = Object.values(counts).reduce((a, b) => a + b, 0);
        document.getElementById('total-archivos').textContent = totalFiles;
        
        // Calcular tamaño total
        let totalSize = 0;
        Object.values(uploadedFiles).forEach(fileArray => {
            if (fileArray) {
                fileArray.forEach(file => {
                    totalSize += file.size;
                });
            }
        });
        
        const totalSizeMB = (totalSize / (1024 * 1024)).toFixed(2);
        document.getElementById('total-tamaño').textContent = `${totalSizeMB} MB`;
    }
    
    function showToast(message, type = 'info') {
        // Reutilizar función del formulario principal
        if (window.formularioCliente && window.formularioCliente.showToast) {
            window.formularioCliente.showToast(message, type);
        } else {
            alert(message); // Fallback
        }
    }
    
    // Inicializar resumen
    updateResumen();
});
</script>

<style>
.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
}

.upload-area:hover {
    border-color: #007bff;
    background-color: rgba(0,123,255,0.05);
}

.upload-area.drag-over {
    border-color: #007bff;
    background-color: rgba(0,123,255,0.1);
}

.logo-upload {
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.logo-preview img {
    max-width: 150px;
    max-height: 150px;
    object-fit: contain;
}

.uploaded-file {
    background-color: #f8f9fa;
    transition: all 0.2s ease;
}

.uploaded-file:hover {
    background-color: #e9ecef;
}

.display-4 {
    font-size: 2rem;
}

@media (max-width: 768px) {
    .upload-area {
        padding: 1rem;
    }
    
    .display-4 {
        font-size: 1.5rem;
    }
}
</style>
